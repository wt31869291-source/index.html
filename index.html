<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥åº·ç®¡å®¶ - æ™ºèƒ½é ç®—ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background-color: #e5e7eb; }
        .day-cell { min-height: 80px; background: white; transition: 0.2s; position: relative; }
        .active-day { background-color: #eef2ff; border: 2px solid #4f46e5 !important; }
        .period-bg { background-color: #fff0f5 !important; }
        .hidden { display: none; }
        .slide-down { animation: slideDown 0.3s ease-out; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 pb-10">

    <div class="max-w-md mx-auto bg-white shadow-lg min-h-screen">
        <div class="bg-indigo-600 text-white p-6 sticky top-0 z-30">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h1 class="text-lg font-bold">ä»Šæ—¥ç†±é‡é ç®—</h1>
                    <p id="todayDateStr" class="text-xs opacity-80"></p>
                </div>
                <div class="text-right">
                    <span id="remainingTag" class="text-[10px] px-2 py-0.5 rounded-full bg-white/20">è¨ˆç®—ä¸­...</span>
                </div>
            </div>
            <div class="flex justify-around items-center text-center">
                <div><p class="text-[10px] opacity-70">æ‰€éœ€</p><p id="tdeeVal" class="text-xl font-bold">1800</p></div>
                <div class="text-2xl font-light opacity-50">-</div>
                <div><p class="text-[10px] opacity-70">å·²æ”å–</p><p id="consumedVal" class="text-xl font-bold text-orange-300">0</p></div>
                <div class="text-2xl font-light opacity-50">=</div>
                <div><p class="text-[10px] opacity-70">å‰©é¤˜</p><p id="remainVal" class="text-2xl font-black text-green-300">1800</p></div>
            </div>
            <div id="dietAdvice" class="mt-4 p-3 bg-white/10 rounded-xl text-xs leading-relaxed italic border border-white/10">
                æ­£åœ¨åˆ†æä½ çš„æ•¸æ“š...
            </div>
        </div>

        <div class="p-4">
            <div class="flex justify-between items-center mb-4">
                <button onclick="changeMonth(-1)" class="p-2">â—€</button>
                <h2 id="monthDisplay" class="font-bold">2026å¹´ 1æœˆ</h2>
                <button onclick="changeMonth(1)" class="p-2">â–¶</button>
            </div>
            <div class="calendar-grid text-center text-[10px] font-bold py-2 bg-gray-200">
                <div>æ—¥</div><div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div>
            </div>
            <div id="calendarBody" class="calendar-grid"></div>
        </div>

        <div id="recordPanel" class="hidden slide-down p-4 border-t bg-gray-50 pb-20">
            <div class="flex justify-between items-center mb-4">
                <h3 id="targetDateTitle" class="font-bold text-indigo-600">æ—¥æœŸç´€éŒ„</h3>
                <button onclick="closePanel()" class="text-gray-400 text-sm">âœ– æ”¶èµ·</button>
            </div>

            <div class="bg-white p-4 rounded-2xl shadow-sm mb-4">
                <div class="flex justify-between items-center mb-3">
                    <h4 class="font-bold text-sm">é£²é£Ÿç´€éŒ„</h4>
                    <span class="text-[10px] text-gray-400">ä¼°ç®—ï¼šä¾¿ç•¶800, éºµ500, é£¯200</span>
                </div>
                <div class="flex gap-2 mb-3">
                    <input type="text" id="foodName" placeholder="é£Ÿç‰©" class="flex-1 p-2 bg-gray-50 rounded-lg text-sm">
                    <input type="number" id="foodCal" placeholder="kcal" class="w-20 p-2 bg-gray-50 rounded-lg text-sm">
                    <button onclick="addOrUpdateFood()" id="addBtn" class="bg-indigo-600 text-white px-4 rounded-lg text-sm">åŠ </button>
                </div>
                <div id="foodList" class="space-y-2"></div>
            </div>

            <div class="grid grid-cols-2 gap-3 mb-4">
                <div class="bg-white p-3 rounded-2xl shadow-sm">
                    <p class="text-[10px] text-gray-400 mb-2">é«”é‡ç´€éŒ„ (kg)</p>
                    <input type="number" step="0.1" id="wt1" placeholder="æ—©" class="w-full mb-2 p-1 bg-blue-50 rounded text-sm">
                    <input type="number" step="0.1" id="wt2" placeholder="æ™š" class="w-full p-1 bg-purple-50 rounded text-sm">
                </div>
                <div class="bg-white p-3 rounded-2xl shadow-sm flex flex-col justify-center items-center">
                    <p class="text-[10px] text-gray-400 mb-2">ç”Ÿç†æœŸ</p>
                    <input type="checkbox" id="periodCheck" onchange="autoSave()" class="w-8 h-8 accent-pink-500">
                </div>
            </div>

            <div class="bg-white p-4 rounded-2xl shadow-sm mb-4 text-sm">
                <h4 class="font-bold mb-2 text-indigo-600">é‹å‹•èˆ‡ä¸‰åœ</h4>
                <div class="grid grid-cols-3 gap-2 mb-3">
                    <input type="number" id="waist" placeholder="è…°" class="p-1 border rounded text-center">
                    <input type="number" id="hip" placeholder="è‡€" class="p-1 border rounded text-center">
                    <input type="number" id="thigh" placeholder="è…¿" class="p-1 border rounded text-center">
                </div>
                <input type="text" id="exSearch" onkeyup="filterEx()" placeholder="æœå°‹é‹å‹•é …ç›®..." class="w-full p-2 bg-gray-100 rounded-lg text-xs mb-2">
                <div id="exList" class="max-h-40 overflow-y-auto space-y-1"></div>
            </div>
            
            <button onclick="closePanel()" class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold">ç¢ºèªå„²å­˜ä¸¦é—œé–‰</button>
        </div>
    </div>

    <script>
        let currentYear, currentMonth, activeDate = "", dailyFoods = [], editIndex = -1;
        const BASE_TDEE = 1800;
        const exData = ["å•éˆ´è² é‡æ·±è¹².è…¿è‡€", "å•éˆ´å¤¾èƒ¸.èƒ¸", "å•éˆ´åˆ’èˆ¹.èƒŒ", "å·¦å³å´æŠ¬è…¿.è…¿", "è·ªå¼å‰å¾Œä¿¯è‡¥æ’.è…¹", "ä¿¯è‡¥å¾ŒæŠ¬è…¿.è‡€", "è…³å¿ƒé–‹åˆ.è…¿", "è·ªå§¿å·¦å³æŠ¬è…¿.è…°è…¹", "è·ªå§¿å¾ŒæŠ¬è…¿.ä¸‹è‡€", "è·ªå§¿å½æ›²æŠ¬è…¿.ä¸Šè‡€", "å•éˆ´wå¤–æ¨.æ‰‹è‡‚", "è‡€æ©‹.è‡€", "å•éˆ´å´å¹³èˆ‰.è‚©", "å•éˆ´ç¡¬æ‹‰.è‡€", "å½ˆåŠ›å¸¶å‰å¾Œç¹è‚©.è‚©èƒŒ", "å½ˆåŠ›å¸¶é«˜ä½ä¸‹æ‹‰.è‚©èƒŒ", "å½ˆåŠ›å¸¶å·¦å³å´æ‹‰.æ‰‹èƒ¸", "å·¦å³è…¿åˆ†è¹².è‡€", "è…³å°–äº¤å‰é»åœ°.è…¹", "äº¤æ›¿æ”¶è…¿.è…¹", "å±ˆè†æ²è…¹.è…¹", "ç›´è…¿æ²è…¹.è…¹", "è‡ªè¡Œè»Šæ²è…¹.è…¹", "å‰ªåˆ€è…¿.è…¹"];

        window.onload = () => {
            const now = new Date();
            currentYear = now.getFullYear();
            currentMonth = now.getMonth();
            document.getElementById('todayDateStr').innerText = now.toLocaleDateString();
            renderCalendar();
            renderExList();
            updateTopBanner();
        };

        function renderCalendar() {
            const body = document.getElementById('calendarBody');
            body.innerHTML = '';
            document.getElementById('monthDisplay').innerText = `${currentYear}å¹´ ${currentMonth + 1}æœˆ`;
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const periodStart = localStorage.getItem('period_start');

            for (let i = 0; i < firstDay; i++) body.innerHTML += `<div class="day-cell bg-gray-50"></div>`;

            for (let d = 1; d <= daysInMonth; d++) {
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                const data = JSON.parse(localStorage.getItem('health_' + dateStr));
                let classes = 'day-cell p-1 cursor-pointer border-r border-b';
                if(activeDate === dateStr) classes += ' active-day';
                if(periodStart) {
                    const diff = (new Date(dateStr) - new Date(periodStart)) / (1000*60*60*24);
                    if(diff >= 0 && diff < 7) classes += ' period-bg';
                }

                body.innerHTML += `<div class="${classes}" onclick="toggleDate('${dateStr}')">
                    <span class="text-[10px] font-bold">${d}</span>
                    ${data && data.totalCal ? `<div class="text-[9px] text-orange-500 mt-1 font-bold">${data.totalCal}k</div>` : ''}
                    ${data && data.wt1 ? `<div class="text-[8px] text-blue-400">${data.wt1}kg</div>` : ''}
                </div>`;
            }
        }

        function toggleDate(date) {
            if(activeDate === date) { closePanel(); return; }
            activeDate = date;
            renderCalendar();
            openPanel(date);
        }

        function openPanel(date) {
            const panel = document.getElementById('recordPanel');
            panel.classList.remove('hidden');
            document.getElementById('targetDateTitle').innerText = date + " ç´€éŒ„";
            const data = JSON.parse(localStorage.getItem('health_' + date)) || {};
            
            document.getElementById('wt1').value = data.wt1 || '';
            document.getElementById('wt2').value = data.wt2 || '';
            document.getElementById('waist').value = data.waist || '';
            document.getElementById('hip').value = data.hip || '';
            document.getElementById('thigh').value = data.thigh || '';
            document.getElementById('periodCheck').checked = (localStorage.getItem('period_start') === date);
            
            dailyFoods = data.foods || [];
            updateFoodUI();
            panel.scrollIntoView({ behavior: 'smooth' });
        }

        function addOrUpdateFood() {
            const name = document.getElementById('foodName').value || "æœªå‘½å";
            const cal = parseInt(document.getElementById('foodCal').value) || 0;
            if(editIndex > -1) dailyFoods[editIndex] = {name, cal};
            else dailyFoods.push({name, cal});
            
            editIndex = -1;
            document.getElementById('addBtn').innerText = "åŠ ";
            document.getElementById('foodName').value = "";
            document.getElementById('foodCal').value = "";
            autoSave();
        }

        function editFood(index) {
            editIndex = index;
            document.getElementById('foodName').value = dailyFoods[index].name;
            document.getElementById('foodCal').value = dailyFoods[index].cal;
            document.getElementById('addBtn').innerText = "æ”¹";
        }

        function deleteFood(index) {
            dailyFoods.splice(index, 1);
            autoSave();
        }

        function updateFoodUI() {
            const list = document.getElementById('foodList');
            let total = 0;
            list.innerHTML = dailyFoods.map((f, i) => {
                total += f.cal;
                return `<div class="flex justify-between items-center bg-gray-50 p-2 rounded-lg text-sm">
                    <span>${f.name} <b class="text-orange-600">${f.cal}</b></span>
                    <div class="flex gap-2">
                        <button onclick="editFood(${i})" class="text-indigo-500">ç·¨è¼¯</button>
                        <button onclick="deleteFood(${i})" class="text-red-400">åˆª</button>
                    </div>
                </div>`;
            }).join('');
            updateTopBanner();
        }

        function autoSave() {
            const totalCal = dailyFoods.reduce((sum, f) => sum + f.cal, 0);
            const data = {
                totalCal, foods: dailyFoods,
                wt1: document.getElementById('wt1').value,
                wt2: document.getElementById('wt2').value,
                waist: document.getElementById('waist').value,
                hip: document.getElementById('hip').value,
                thigh: document.getElementById('thigh').value
            };
            localStorage.setItem('health_' + activeDate, JSON.stringify(data));
            if(document.getElementById('periodCheck').checked) localStorage.setItem('period_start', activeDate);
            else if(localStorage.getItem('period_start') === activeDate) localStorage.removeItem('period_start');
            updateFoodUI();
            renderCalendar();
        }

        function closePanel() {
            activeDate = "";
            document.getElementById('recordPanel').classList.add('hidden');
            renderCalendar();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateTopBanner() {
            const todayStr = new Date().toISOString().split('T')[0];
            const data = JSON.parse(localStorage.getItem('health_' + todayStr)) || {};
            const consumed = data.totalCal || 0;
            const periodStart = localStorage.getItem('period_start');
            let tdee = BASE_TDEE;
            
            if(periodStart) {
                const diff = (new Date(todayStr) - new Date(periodStart)) / (1000*60*60*24);
                if(diff >= 0 && diff < 7) tdee += 200;
            }

            const remain = tdee - consumed;
            document.getElementById('tdeeVal').innerText = tdee;
            document.getElementById('consumedVal').innerText = consumed;
            document.getElementById('remainVal').innerText = remain;
            
            const adviceEl = document.getElementById('dietAdvice');
            if(remain > 800) adviceEl.innerText = "ğŸŒŸ å‰©é¤˜é ç®—å……æ²›ï¼ä¸‹ä¸€é¤å¯ä»¥åƒå¾—è±å¯Œé»ï¼Œå»ºè­°åŠ ä»½é›è…¿æˆ–é­šã€‚";
            else if(remain > 400) adviceEl.innerText = "ğŸ¥— é ç®—é©ä¸­ã€‚å»ºè­°æ¥ä¸‹ä¾†ä»¥ä½GIé£²é£Ÿç‚ºä¸»ï¼Œå¦‚ä¹¾éºµé…ç‡™é’èœã€‚";
            else if(remain > 0) adviceEl.innerText = "ğŸ é ç®—å¿«ç”¨å®Œäº†ï¼å»ºè­°ä¸‹ä¸€é¤åªæ”å–è›‹ç™½è³ªèˆ‡è”¬èœï¼ˆå¦‚è¶…å•†æ²™æ‹‰ï¼‰ã€‚";
            else adviceEl.innerText = "âš ï¸ ä»Šæ—¥å·²é”æ¨™ï¼å¦‚æœé‚„é¤“ï¼Œè«‹å¤šå–æ°´æˆ–åƒäº›å°é»ƒç“œã€è’Ÿè’»å¢Šèƒƒã€‚";
        }

        function changeMonth(step) {
            currentMonth += step;
            if(currentMonth > 11) { currentMonth = 0; currentYear++; }
            if(currentMonth < 0) { currentMonth = 11; currentYear--; }
            renderCalendar();
        }

        function renderExList() {
            const list = document.getElementById('exList');
            list.innerHTML = exData.map(ex => {
                const [name, part] = ex.split('.');
                return `<div class="ex-item flex justify-between items-center p-2 bg-white border border-gray-100 rounded-lg shadow-sm" data-key="${ex}">
                    <div class="text-[10px]"><b>${name}</b> <span class="text-gray-400">${part}</span></div>
                    <div class="flex gap-1 items-center text-[10px]"><input type="number" placeholder="ä¸‹" class="w-8 p-1 border rounded text-center">x<input type="number" placeholder="çµ„" class="w-8 p-1 border rounded text-center"></div>
                </div>`;
            }).join('');
        }

        function filterEx() {
            const q = document.getElementById('exSearch').value.toLowerCase();
            document.querySelectorAll('.ex-item').forEach(el => {
                el.style.display = el.dataset.key.toLowerCase().includes(q) ? 'flex' : 'none';
            });
        }
    </script>
</body>
</html>

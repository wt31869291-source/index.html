<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>高級莫蘭迪健康筆記 v16</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --m-bg: #f4f6f7; --m-blue: #8fa3ad; --m-dark: #4a555c; }
        body { background: var(--m-bg); font-family: sans-serif; color: var(--m-dark); -webkit-tap-highlight-color: transparent; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .day-cell { min-height: 100px; background: #fff; border-radius: 14px; border: 1px solid #e2e8f0; position: relative; }
        .today-mark { border: 2.5px solid var(--m-blue) !important; }
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: flex-end; }
        .modal-overlay.active { display: flex; }
        .modal-content { background: #fff; width: 100%; max-width: 450px; border-radius: 30px 30px 0 0; height: 90vh; display: flex; flex-direction: column; }
        #trendModal { display: none; position: fixed; inset: 0; background: white; z-index: 2000; flex-direction: column; overflow-y: auto; padding: 24px; }
        #trendModal.active { display: flex; }
        .tag { cursor: pointer; background: #f8fafc; padding: 5px 10px; border-radius: 8px; font-size: 11px; margin: 2px; border: 1px solid #edf2f7; }
    </style>
</head>
<body>

    <div class="max-w-md mx-auto min-h-screen pb-6">
        <div class="p-8 text-white rounded-b-[45px] shadow-lg" style="background: #6a7c85;" onclick="showTrend()">
            <div class="flex justify-between items-start mb-6">
                <div><h1 class="text-xl tracking-widest opacity-90 font-medium">HEALTH LOG</h1><p id="topDate" class="text-[10px] opacity-70 mt-1"></p></div>
                <div class="text-right"><p class="text-[10px] opacity-70 mb-1">目前體重</p><p id="topW" class="text-4xl font-light tracking-tighter">--</p></div>
            </div>
            <div class="bg-black/10 p-4 rounded-2xl mb-6 text-xs leading-relaxed border-l-4 border-white/50"><span id="topAdvice">讀取數據中...</span></div>
            <div class="grid grid-cols-2 gap-4 text-center">
                <div class="bg-white/10 p-3 rounded-2xl"><p class="text-[10px] opacity-80 mb-1">剩餘預算</p><p id="topRem" class="text-lg font-bold">--</p></div>
                <div class="bg-white/10 p-3 rounded-2xl"><p class="text-[10px] opacity-80 mb-1">總消耗</p><p id="topExCal" class="text-lg font-bold">0</p></div>
            </div>
        </div>

        <div class="p-5">
            <div id="calendarBody" class="calendar-grid mt-4"></div>
        </div>
    </div>

    <div id="trendModal">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-xl font-bold text-slate-600">數據趨勢</h3>
            <button type="button" onclick="hideTrend()" class="text-slate-300 text-3xl p-2">✕</button>
        </div>
        <canvas id="weightChart" class="mb-8"></canvas>
        <canvas id="calorieChart"></canvas>
    </div>

    <div id="recordModal" class="modal-overlay" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="p-6 border-b flex justify-between items-center bg-white z-50 rounded-t-3xl">
                <h3 id="modalDateTitle" class="font-bold text-slate-600">數據錄入</h3>
                <button type="button" onclick="closeModal()" class="text-slate-300 text-4xl p-2">✕</button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-6 space-y-8">
                <div class="space-y-3">
                    <label class="text-xs font-bold text-slate-400 uppercase tracking-widest">⚖️ 體重監測</label>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="p-4 bg-slate-50 rounded-2xl">
                            <input type="text" id="w1L" class="w-full bg-transparent text-[10px] text-slate-400 mb-1 border-none p-0">
                            <input type="number" step="0.1" id="w1" placeholder="0.0" class="w-full bg-transparent font-bold text-2xl text-slate-6

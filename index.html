<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç²‰å«©å¥åº·ç®¡å®¶ - æ™ºèƒ½ä¼°ç®—ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --main-pink: #fff5f6; --accent-pink: #ffb7c5; --period-blue: #e0f2fe; }
        body { background-color: var(--main-pink); font-family: sans-serif; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .day-cell { min-height: 75px; background: white; border-radius: 12px; position: relative; transition: 0.2s; border: 1px solid #ffe4e8; }
        .today-border { border: 3px solid #ff8fa3 !important; }
        .period-strip { position: absolute; bottom: 4px; left: 4px; right: 4px; height: 6px; background: #bae6fd; border-radius: 10px; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 50; align-items: center; justify-content: center; padding: 20px; }
        .modal.active { display: flex; }
        .hidden { display: none; }
        .estimate-tag { cursor: pointer; background: #ffe4e8; padding: 2px 8px; border-radius: 99px; font-size: 10px; color: #ff4d6d; margin-top: 4px; display: inline-block; }
    </style>
</head>
<body class="text-gray-700">

    <div class="max-w-md mx-auto min-h-screen pb-10 shadow-xl bg-white">
        <div class="p-6 bg-[#ffdae0] rounded-b-[40px] shadow-sm">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-xl font-bold text-[#ff4d6d]">ğŸŒ¸ å¥åº·å°ç®¡å®¶</h1>
                <span id="todayLabel" class="text-xs bg-white/50 px-3 py-1 rounded-full">2026/01/20</span>
            </div>
            
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div class="bg-white/60 p-3 rounded-2xl">
                    <p class="text-[10px] text-pink-500 font-bold">æœ¬é€±é«”é‡æ³¢å‹•</p>
                    <p id="weightSwing" class="text-lg font-black text-gray-700">-- kg</p>
                </div>
                <div class="bg-white/60 p-3 rounded-2xl">
                    <p class="text-[10px] text-pink-500 font-bold">ç†±é‡å‰©é¤˜</p>
                    <p id="topRemain" class="text-lg font-black text-pink-600">-- kcal</p>
                </div>
            </div>
            
            <div id="smartAdvice" class="text-[11px] italic text-[#ff4d6d] bg-white/40 p-2 rounded-xl border border-white/50">
                é»æ“Šæ—¥æœŸé–‹å§‹è¨˜éŒ„ï¼Œæˆ‘æœƒçµ¦ä½ å»ºè­°å–”ï¼
            </div>
        </div>

        <div class="p-4">
            <div class="flex justify-between items-center mb-4 text-[#ff4d6d] font-bold">
                <button onclick="changeMonth(-1)">â—€</button>
                <h2 id="monthTitle">2026å¹´ 1æœˆ</h2>
                <button onclick="changeMonth(1)">â–¶</button>
            </div>
            <div class="calendar-grid text-center text-[10px] text-pink-300 mb-2">
                <div>æ—¥</div><div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div>
            </div>
            <div id="calendarBody" class="calendar-grid"></div>
        </div>
    </div>

    <div id="recordModal" class="modal">
        <div class="bg-white w-full max-w-sm rounded-[30px] overflow-hidden shadow-2xl animate-slide-up">
            <div class="p-4 bg-[#ffdae0] flex justify-between items-center">
                <h3 id="modalDateTitle" class="font-bold text-[#ff4d6d]">2026-01-20</h3>
                <button onclick="closeModal()" class="text-[#ff4d6d] text-xl">âœ•</button>
            </div>
            
            <div class="p-5 space-y-4 max-h-[70vh] overflow-y-auto">
                <div class="bg-pink-50 p-4 rounded-2xl">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-sm font-bold text-pink-600">é£²é£Ÿç†±é‡</label>
                        <span id="modalDayTotal" class="text-xs font-bold text-pink-400">0 kcal</span>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="foodIn" oninput="showEstimate(this.value)" placeholder="é£Ÿç‰©" class="flex-1 p-2 rounded-xl border-none text-sm outline-pink-200">
                        <input type="number" id="calIn" placeholder="kcal" class="w-20 p-2 rounded-xl border-none text-sm outline-pink-200">
                        <button onclick="saveFood()" id="foodBtn" class="bg-[#ff4d6d] text-white px-3 rounded-xl text-sm">åŠ </button>
                    </div>
                    <div id="estimateBox"></div>
                    <div id="foodList" class="mt-3 space-y-2"></div>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-blue-50 p-3 rounded-2xl">
                        <label class="text-xs font-bold text-blue-600">é«”é‡ (æ—©/æ™š)</label>
                        <input type="number" id="w1" placeholder="æ—©" class="w-full mt-1 p-1 bg-transparent border-b border-blue-200 text-sm focus:outline-none">
                        <input type="number" id="w2" placeholder="æ™š" class="w-full mt-1 p-1 bg-transparent border-b border-blue-200 text-sm focus:outline-none">
                    </div>
                    <div class="bg-cyan-50 p-3 rounded-2xl">
                        <label class="text-xs font-bold text-cyan-600">é£²æ°´ (ml)</label>
                        <input type="number" id="waterIn" placeholder="ç¸½é‡" class="w-full mt-1 p-1 bg-transparent border-b border-cyan-200 text-sm focus:outline-none">
                    </div>
                </div>

                <div class="flex justify-between items-center bg-red-50 p-3 rounded-2xl">
                    <span class="text-xs font-bold text-red-600">ç”Ÿç†æœŸ</span>
                    <input type="checkbox" id="pCheck" class="w-6 h-6 accent-red-400">
                </div>

                <div class="bg-gray-50 p-3 rounded-2xl">
                    <label class="text-[10px] text-gray-400">ä¸‰åœç´€éŒ„ (è…°/è‡€/è…¿)</label>
                    <div class="flex gap-2 mt-1">
                        <input type="number" id="waist" placeholder="è…°" class="w-1/3 p-1 text-center bg-white rounded border-none text-xs">
                        <input type="number" id="hip" placeholder="è‡€" class="w-1/3 p-1 text-center bg-white rounded border-none text-xs">
                        <input type="number" id="thigh" placeholder="è…¿" class="w-1/3 p-1 text-center bg-white rounded border-none text-xs">
                    </div>
                </div>
            </div>
            
            <div class="p-4">
                <button onclick="finalSave()" class="w-full bg-[#ff4d6d] text-white py-3 rounded-2xl font-bold shadow-lg shadow-pink-100">å„²å­˜ç´€éŒ„</button>
            </div>
        </div>
    </div>

    <script>
        let currentYear, currentMonth, activeDate = "", dailyFoods = [], editIndex = -1;
        const calDict = { "æ’éª¨é£¯": 850, "é›è‚‰é£¯": 450, "ç‰›è‚‰éºµ": 650, "æ»·è‚‰é£¯": 500, "ç‡™é’èœ": 50, "çå¥¶": 650, "é›æ’": 750, "è›‹é¤…": 300, "ä¸‰æ˜æ²»": 350, "ä¹¾éºµ": 500, "ç«é‹": 1000, "ä¾¿ç•¶": 800 };

        window.onload = () => {
            const now = new Date();
            currentYear = now.getFullYear();
            currentMonth = now.getMonth();
            document.getElementById('todayLabel').innerText = now.toLocaleDateString();
            renderCalendar();
            updateTopUI();
        };

        function renderCalendar() {
            const body = document.getElementById('calendarBody');
            body.innerHTML = '';
            document.getElementById('monthTitle').innerText = `${currentYear}å¹´ ${currentMonth + 1}æœˆ`;
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const periodStart = localStorage.getItem('period_start');
            const todayStr = new Date().toISOString().split('T')[0];

            for (let i = 0; i < firstDay; i++) body.innerHTML += `<div></div>`;

            for (let d = 1; d <= daysInMonth; d++) {
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                const data = JSON.parse(localStorage.getItem('health_' + dateStr));
                let classes = 'day-cell p-1 cursor-pointer';
                if(dateStr === todayStr) classes += ' today-border';
                
                let pTag = '';
                if(periodStart) {
                    const diff = (new Date(dateStr) - new Date(periodStart)) / (1000*60*60*24);
                    if(diff >= 0 && diff < 7) pTag = `<div class="period-strip"></div>`;
                }

                body.innerHTML += `<div class="${classes}" onclick="openModal('${dateStr}')">
                    <span class="text-[10px] font-bold text-pink-400">${d}</span>
                    ${data && data.totalCal ? `<div class="text-[9px] text-orange-400 font-bold mt-1">${data.totalCal}</div>` : ''}
                    ${data && data.w1 ? `<div class="text-[8px] text-gray-400">${data.w1}</div>` : ''}
                    ${pTag}
                </div>`;
            }
        }

        function openModal(date) {
            activeDate = date;
            document.getElementById('modalDateTitle').innerText = date;
            const data = JSON.parse(localStorage.getItem('health_' + date)) || {};
            document.getElementById('w1').value = data.w1 || '';
            document.getElementById('w2').value = data.w2 || '';
            document.getElementById('waterIn').value = data.water || '';
            document.getElementById('waist').value = data.waist || '';
            document.getElementById('hip').value = data.hip || '';
            document.getElementById('thigh').value = data.thigh || '';
            document.getElementById('pCheck').checked = (localStorage.getItem('period_start') === date);
            dailyFoods = data.foods || [];
            updateFoodUI();
            document.getElementById('recordModal').classList.add('active');
        }

        function showEstimate(val) {
            const box = document.getElementById('estimateBox');
            box.innerHTML = '';
            for(let k in calDict) {
                if(val && k.includes(val)) {
                    box.innerHTML = `<div class="estimate-tag" onclick="useEst('${k}', ${calDict[k]})">ğŸ’¡ çŒœä½ æƒ³æ‰¾: ${k} (${calDict[k]}k)</div>`;
                    break;
                }
            }
        }

        function useEst(name, cal) {
            document.getElementById('foodIn').value = name;
            document.getElementById('calIn').value = cal;
            document.getElementById('estimateBox').innerHTML = '';
        }

        function saveFood() {
            const name = document.getElementById('foodIn').value || "é£Ÿç‰©";
            const cal = parseInt(document.getElementById('calIn').value) || 0;
            if(editIndex > -1) dailyFoods[editIndex] = {name, cal};
            else dailyFoods.push({name, cal});
            editIndex = -1;
            document.getElementById('foodIn').value = "";
            document.getElementById('calIn').value = "";
            document.getElementById('foodBtn').innerText = "åŠ ";
            updateFoodUI();
        }

        function updateFoodUI() {
            const list = document.getElementById('foodList');
            let total = 0;
            list.innerHTML = dailyFoods.map((f, i) => {
                total += f.cal;
                return `<div class="flex justify-between bg-white/50 p-2 rounded-lg text-xs">
                    <span>${f.name} (<b>${f.cal}</b>)</span>
                    <div class="flex gap-2">
                        <button onclick="editF(${i})" class="text-blue-400">æ”¹</button>
                        <button onclick="delF(${i})" class="text-red-300">åˆª</button>
                    </div>
                </div>`;
            }).join('');
            document.getElementById('modalDayTotal').innerText = total + " kcal";
        }

        function editF(i) {
            editIndex = i;
            document.getElementById('foodIn').value = dailyFoods[i].name;
            document.getElementById('calIn').value = dailyFoods[i].cal;
            document.getElementById('foodBtn').innerText = "æ”¹";
        }

        function delF(i) { dailyFoods.splice(i, 1); updateFoodUI(); }

        function finalSave() {
            const totalCal = dailyFoods.reduce((s, f) => s + f.cal, 0);
            const data = {
                totalCal, foods: dailyFoods,
                w1: document.getElementById('w1').value,
                w2: document.getElementById('w2').value,
                water: document.getElementById('waterIn').value,
                waist: document.getElementById('waist').value,
                hip: document.getElementById('hip').value,
                thigh: document.getElementById('thigh').value
            };
            localStorage.setItem('health_' + activeDate, JSON.stringify(data));
            if(document.getElementById('pCheck').checked) localStorage.setItem('period_start', activeDate);
            else if(localStorage.getItem('period_start') === activeDate) localStorage.removeItem('period_start');
            closeModal();
            renderCalendar();
            updateTopUI();
        }

        function closeModal() { document.getElementById('recordModal').classList.remove('active'); activeDate = ""; }

        function updateTopUI() {
            const todayStr = new Date().toISOString().split('T')[0];
            const data = JSON.parse(localStorage.getItem('health_' + todayStr)) || {};
            const periodStart = localStorage.getItem('period_start');
            let tdee = 1800;
            if(periodStart) {
                const diff = (new Date(todayStr) - new Date(periodStart)) / (1000*60*60*24);
                if(diff >= 0 && diff < 7) tdee += 200;
            }
            const remain = tdee - (data.totalCal || 0);
            document.getElementById('topRemain').innerText = remain + " kcal";
            
            // é«”é‡æ³¢å‹• (æœ€è¿‘7å¤©)
            let ws = [];
            for(let i=0; i<7; i++) {
                const d = new Date(); d.setDate(d.getDate()-i);
                const k = 'health_' + d.toISOString().split('T')[0];
                const res = JSON.parse(localStorage.getItem(k));
                if(res && res.w1) ws.push(parseFloat(res.w1));
            }
            if(ws.length > 0) {
                const swing = Math.max(...ws) - Math.min(...ws);
                document.getElementById('weightSwing').innerText = swing.toFixed(1) + " kg";
            }
        }

        function changeMonth(s) {
            currentMonth += s;
            if(currentMonth > 11) { currentMonth = 0; currentYear++; }
            if(currentMonth < 0) { currentMonth = 11; currentYear--; }
            renderCalendar();
        }
    </script>
</body>
</html>
